@using System
@using Sandbox;
@using Sandbox.MenuSystem;
@using Sandbox.UI;
@using Sandbox.Menu;

@attribute [StyleSheet]
@namespace TFS2.Menu
@implements IGameMenuPanel
@inherits NavHostPanel

<root class="tfs2menu">

</root>

@code
{
    public static MainMenu Current { get; private set; }
    internal Music Music { get; set; }

    public MainMenu()
    {
        Current = this;
        DefaultUrl = "/";
        Music = new();

        AddDestination("/", typeof(MainPage));
        AddDestination("/lobby", typeof(LobbyPage));
        AddDestination("/lobby/maps", typeof(LobbyMapPage));
        AddDestination("/lobby/settings", typeof(LobbyConfigurationPage));
        AddDestination("/lobby/addons", typeof(LobbyAddonPage));
        AddDestination("/loadout", typeof(LoadoutSelection));

        /*
        AddDestination("/load", typeof(LoadGamePage));
        AddDestination("/active", typeof(ActivePage));
        AddDestination("/active/map", typeof(ActiveMapPage));
        AddDestination("/servers", typeof(ServerListPage));
         */

        if (Game.InGame) Navigate("/");

        BindClass("ingame", () => Game.InGame);
        BindClass("inlobby", () => Game.Menu.Lobby != null);
    }

    public override void Tick()
    {
        Music.Tick();
    }

    protected override void OnEvent(PanelEvent e)
    {
        if (e.Name == "package.changed")
        {
            StateHasChanged();
            return;
        }

        base.OnEvent(e);
    }

    [GameEvent.Menu.ServerJoined]
    public void OnServerJoined()
    {
        Music.Stop();
        Music.Enabled = false;
        //Navigate("/active");
    }
    [GameEvent.Menu.ServerLeave]
    public void OnServerLeave()
    {
        Music.Enabled = true;
        Navigate("/");
    }

    [GameEvent.Menu.LobbyJoined]
    public void OnLobbyJoined() => Navigate("/lobby");

    [GameEvent.Menu.LobbyLeave]
    public void OnLobbyLeave() => Navigate("/");

}
